# ネイバー層

-   隣接しているノードを管理する．
-   接しているノードにフレームを届ける．
-   [ノードID](./node.md#ノードID)をメディアのアドレスに変換する．

## ネイバー関係管理プロトコル

### プロトコル番号

1

### フレームタイプ

| タイプ    | 値  |
| --------- | --- |
| Hello     | 1   |
| Hello Ack | 2   |
| Goodbye   | 3   |

### Hello / Hello Ack

| #   | フィールド名                     | サイズ(byte) |
| --- | -------------------------------- | ------------ |
| 1   | フレームタイプ                   | 1            |
| 2   | 送信者のノードID                 | 可変長       |
| 3   | 送信者のノードコスト             | 2            |
| 4   | 送信者と受信者の間のリンクコスト | 2            |

### Goodbye

| #   | フィールド名     | サイズ(byte) |
| --- | ---------------- | ------------ |
| 1   | フレームタイプ   | 1            |
| 2   | 送信者のノードID | 2            |

## ネイバー間データ転送プロトコル

### ユニキャスト

1対1でフレームを転送する．

引数としてノードIDを取り，それをメディアのアドレスに変換して上で，[リンク層](./link.md)に送信を要求する．

### ブロードキャスト

ネイバー関係にあるすべてのノードにフレームを転送する．

メディアによってはブロードキャストに対応していない場合もあるため，適宜ユニキャストを混ぜて通信を行う．

#### アルゴリズム

1. ブロードキャスト可能なアドレスに対してブロードキャストを行う．
2. 全てのネイバー関係にあるノードに対して，それぞれ以下を行う．
    1. 処理対象のノードを`対象ノード`とする
    2. `対象ノード`がブロードキャスト可能なアドレスを持たない場合，\
       `対象ノード`の持つどれか一つのアドレスにユニキャストで送信する．
