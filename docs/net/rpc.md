# RPC

ノードの機能を遠隔から呼び出すプロトコル．

## プロトコル番号

3

## プロトコル

下位プロトコルとして[Routing](./routing.md#Routing) を使用している

## フレームレイアウト

### フレームタイプ

| タイプ   | 値  |
| -------- | --- |
| Request  | 1   |
| Response | 2   |

### プロシージャ番号

| プロシージャ名            | 値  | 説明                                                           |
| ------------------------- | --- | -------------------------------------------------------------- |
| Blink                     | 1   | ArduinoのオンボードLEDを点滅させる                             |
| GetMediaList              | 100 | ノードに接続されているメディア一覧を取得する                   |
| ScanAccessPoints          | 300 | Wi-Fiのアクセスポイントを探す                                  |
| GetConnectedAccessPoint   | 301 | 接続済みのWi-Fiアクセスポイントを取得する                      |
| ConnectToAccessPoint      | 302 | Wi-Fiアクセスポイントに接続する                                |
| DisconnectFromAccessPoint | 303 | 接続しているWi-Fiアクセスポイントから切断する                  |
| StartServer               | 320 | サーバを起動しフレームを受信できる状態にする                   |
| SendHello                 | 500 | NeighborプロトコルのHelloフレームを送信する                    |
| SendGoodbye               | 501 | NeighborプロトコルのGoodbyeフレームを送信する                  |
| GetNeighborList           | 520 | NeighborプロトコルにてNeighbor関係となっているノードを取得する |

### RPCステータス

| ステータス名   | 値  | 説明                                               |
| -------------- | --- | -------------------------------------------------- |
| Success        | 1   | 処理が正常に完了した                               |
| Failed         | 2   | 何らかの原因で処理が正常に完了しなかった           |
| NotSupported   | 3   | 指定されたプロシージャの機能を持たないノードである |
| BadArgument    | 4   | リクエストの引数に問題がある                       |
| NotImplemented | 5   | 未実装である                                       |
| Timeout        | 6   | 処理がタイムアウトした                             |
| Unreachable    | 7   | 実行を要求するサーバノードに到達できなかった       |

### リクエストフレーム

| #   | フィールド名     | サイズ(byte) | 備考                       |
| --- | ---------------- | ------------ | -------------------------- |
| 1   | フレームタイプ   | 1            |                            |
| 2   | プロシージャ番号 | 2            |                            |
| 3   | フレームID       | 2            |                            |
| 4   | リクエスト引数   | 可変         | プロシージャによって異なる |

### レスポンスフレーム

| #   | フィールド名     | サイズ(byte) | 備考                       |
| --- | ---------------- | ------------ | -------------------------- |
| 1   | フレームタイプ   | 1            |                            |
| 2   | プロシージャ番号 | 2            |                            |
| 3   | フレームID       | 2            |                            |
| 4   | RPCステータス    | 1            |                            |
| 5   | レスポンスボディ | 可変         | プロシージャによって異なる |
